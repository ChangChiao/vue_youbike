var ee=Object.defineProperty,te=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var G=(e,t,a)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,w=(e,t)=>{for(var a in t||(t={}))ae.call(t,a)&&G(e,a,t[a]);if(D)for(var a of D(t))ne.call(t,a)&&G(e,a,t[a]);return e},L=(e,t)=>te(e,oe(t));import{r as $,o as m,c as _,a as b,w as H,b as d,F as k,d as M,e as se,t as T,p as N,f as B,u as re,g as I,h as P,i as C,v as ie,j as R,k as ce,l as le,m as V,n as U,q as Z,L as p,s as ue,x as de,y as pe,z as me,A as he,B as _e,C as ge,V as ye,D as fe,E as ve,G as we}from"./vendor.4d9ddf6e.js";const be=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const n of c.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function a(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(s){if(s.ep)return;s.ep=!0;const c=a(s);fetch(s.href,c)}};be();var q="./images/logo.png";var S=(e,t)=>{for(const[a,o]of t)e[a]=o;return e};const ke={setup(){return{menuList:[{title:"\u5C0B\u627E\u55AE\u8ECA",path:"/bikemap"},{title:"\u5C0B\u627E\u8ECA\u9053",path:"/routemap"}]}}},Se=e=>(N("data-v-61dd7a3d"),e=e(),B(),e),$e={class:"flex relative z-20 justify-between shadow-lg items-center px-3 font-medium h-20"},Ie=Se(()=>d("img",{class:"w-20",src:q,alt:""},null,-1)),xe={class:"menu flex"};function Ae(e,t,a,o,s,c){const n=$("router-link");return m(),_("header",$e,[b(n,{to:"/"},{default:H(()=>[Ie]),_:1}),d("ul",xe,[(m(!0),_(k,null,M(o.menuList,u=>(m(),_("li",{class:"mx-3 text-lg text-base",key:u.path},[b(n,{to:u.path,class:"duration-200"},{default:H(()=>[se(T(u.title),1)]),_:2},1032,["to"])]))),128))])])}var z=S(ke,[["render",Ae],["__scopeId","data-v-61dd7a3d"]]);const Le={components:{Header:z},setup(){}};function Me(e){return(t,a)=>{const o=$("router-view");return m(),_(k,null,[b(z),b(o)],64)}}const Te=Object.assign(Le,{setup:Me}),E="https://ptx.transportdata.tw/MOTC/v2",Ce=E+"/Cycling/Shape",Ne=E+"/Bike/Station/NearBy",Be=E+"/Bike/Availability/NearBy",O=[{label:"\u81FA\u5317\u5E02",value:"Taipei"},{label:"\u65B0\u5317\u5E02",value:"NewTaipei"},{label:"\u6843\u5712\u5E02",value:"Taoyuan"},{label:"\u81FA\u4E2D\u5E02",value:"Taichung"},{label:"\u81FA\u5357\u5E02",value:"Tainan"},{label:"\u9AD8\u96C4\u5E02",value:"Kaohsiung"},{label:"\u57FA\u9686\u5E02",value:"Keelung"},{label:"\u65B0\u7AF9\u5E02",value:"Hsinchu"},{label:"\u65B0\u7AF9\u7E23",value:"HsinchuCounty"},{label:"\u82D7\u6817\u7E23",value:"MiaoliCounty"},{label:"\u5F70\u5316\u7E23",value:"ChanghuaCounty"},{label:"\u5357\u6295\u7E23",value:"NantouCounty"},{label:"\u96F2\u6797\u7E23",value:"YunlinCounty"},{label:"\u5609\u7FA9\u7E23",value:"ChiayiCounty"},{label:"\u5609\u7FA9\u5E02",value:"Chiayi"},{label:"\u5C4F\u6771\u7E23",value:"PingtungCounty"},{label:"\u5B9C\u862D\u7E23",value:"YilanCounty"},{label:"\u82B1\u84EE\u7E23",value:"HualienCounty"},{label:"\u81FA\u6771\u7E23",value:"TaitungCounty"},{label:"\u91D1\u9580\u7E23",value:"KinmenCounty"},{label:"\u6F8E\u6E56\u7E23",value:"PenghuCounty"},{label:"\u9023\u6C5F\u7E23",value:"LienchiangCounty"}];var Pe="./images/illustration.png";const Re={components:{Header:z},setup(){const e=re(),t=I({city:"",keyword:""}),a=()=>{e.push({query:{keyword:t.keyword,city:t.city}})};return L(w({},P(t)),{search:a,CITY_LIST:O})}},x=e=>(N("data-v-c221866a"),e=e(),B(),e),Ue={class:"cover relative bg-blue"},ze={class:"search w-96 ml-40 pt-12"},Ee=x(()=>d("img",{class:"w-60",src:q,alt:""},null,-1)),Oe=x(()=>d("p",{class:"text-3xl text-base font-extrabold"},"\u5C0B\u627E\u55AE\u8ECA,",-1)),Ye=x(()=>d("p",{class:"text-3xl text-base font-extrabold"},"\u4F86\u5834\u60A0\u9592\u7684\u653E\u9B06\u4E4B\u65C5\uFF01",-1)),je={class:"input-box py-2 mt-10"},De={class:"flex pt-3"},Ge=x(()=>d("option",{value:""},"\u7E23\u5E02",-1)),He=["value"],Ve=x(()=>d("img",{class:"fixed bottom-60",src:Pe},null,-1));function Ze(e,t,a,o,s,c){const n=$("BootstrapIcon");return m(),_("div",Ue,[d("div",ze,[Ee,Oe,Ye,d("div",je,[b(n,{icon:"search",size:"lg","flip-v":""}),C(d("input",{class:"w-1/2 pl-4",placeholder:"\u8F38\u5165\u95DC\u9375\u5B57","onUpdate:modelValue":t[0]||(t[0]=u=>e.keyword=u),type:"text"},null,512),[[ie,e.keyword]])]),d("div",De,[C(d("select",{class:"w-1/2",name:"",id:"","onUpdate:modelValue":t[1]||(t[1]=u=>e.city=u)},[Ge,(m(!0),_(k,null,M(o.CITY_LIST,u=>(m(),_("option",{key:u.value,value:u.value},T(u.label),9,He))),128))],512),[[R,e.city]]),d("button",{onClick:t[2]||(t[2]=(...u)=>o.search&&o.search(...u)),class:"ml-2 w-1/2"},"\u641C\u5C0B")])]),Ve])}var qe=S(Re,[["render",Ze],["__scopeId","data-v-c221866a"]]);const A=ce.create();A.interceptors.request.use(e=>e,e=>e);A.interceptors.response.use(e=>e.data,e=>Promise.reject(e));const Y=()=>{let e="b65665fcca144956a79d25bb3edc7b34",t="daVxLDO01nPgTTwhQKVBmY-pjeQ";const a=new Date().toGMTString(),o=new le("SHA-1","TEXT");o.setHMACKey(t,"TEXT"),o.update("x-date: "+a);let s=o.getHMAC("B64");return{Authorization:`hmac username="${e}", algorithm="hmac-sha1", headers="x-date", signature="${s}"`,"X-Date":a,"Content-Type":"application/x-www-form-urlencoded"}},Ke=e=>{const{city:t=""}=e;return delete e.city,{cityPath:t,data:e}},Fe=e=>{const{cityPath:t,data:a}=Ke(e);let o={headers:Y(),params:w({},a)};return A.get(Ce+`/${t}`,o)},Je=e=>{let t={headers:Y(),params:w({},e)};return A.get(Ne,t)},Qe=e=>{let t={headers:Y(),params:w({},e)};return A.get(Be,t)};const Xe={setup(){let e=null,t=null,a=null;const o=I({city:O[0].value,bikeRoute:"",routeList:[]}),s=()=>{let r="pk.eyJ1Ijoiam9lY2hhbmcxMDE0IiwiYSI6ImNrdno1ZnM3OTRtM2YzMG8wYnA2NGxpZzEifQ.EDTMLv4rcckA89UjJNWgXQ";e=p.map("map_route"),p.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:r}).addTo(e),a=new p.MarkerClusterGroup().addTo(e),g()},c=()=>{a.clearLayers(),e.eachLayer(r=>{r instanceof p.Marker&&e.removeLayer(r)})},n=async()=>{const r={city:o.city};try{const l=await Fe(r);l.length>1&&(o.routeList=l,o.bikeRoute=l[0].RouteName)}catch(l){console.log("error",l)}},u=()=>{const{Geometry:r}=o.routeList.find(l=>l.RouteName===o.bikeRoute);v(r)};V(()=>o.city,()=>{n()}),V(()=>o.bikeRoute,()=>{u()});const y=()=>{new p.Icon({iconUrl:"/images/mark/RecordCircle.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),t=new p.Icon({iconUrl:"images/mark/currentLocation.png",shadowUrl:"",iconSize:[40,41],iconAnchor:[12,41],popupAnchor:[1,-34]})},g=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(r=>{const l=r.coords.longitude,i=r.coords.latitude;console.log("longitude",l),console.log("latitude",i),e.setView([i,l],18),p.marker([i,l],{icon:t}).addTo(e).bindPopup("A pretty CSS3 popup.<br> Easily customizable.").openPopup(),n()},r=>{const{code:l,message:i}=r;console.log("error",`code=${l}, msg=${i}`)})},v=r=>{console.log("Geometry",r),c();const l=new ue.exports.Wkt;l.read(r);const i=l.toJson(),h={color:"olive",weight:5};a=p.geoJSON(i,{style:h}).addTo(e),a.addData(i),e.fitBounds(a.getBounds()),e.addLayer(a)};return U(()=>{y(),s()}),Z(()=>{e=null}),L(w({},P(o)),{CITY_LIST:O})}},We=e=>(N("data-v-3aad47fd"),e=e(),B(),e),et=We(()=>d("div",{id:"map_route",class:"w-screen h-screen"},null,-1)),tt={class:"fixed top-20 right-10 w-20 h-20 z-20"},ot=["value"],at=["value"];function nt(e,t,a,o,s,c){return m(),_(k,null,[et,d("div",tt,[C(d("select",{name:"",id:"","onUpdate:modelValue":t[0]||(t[0]=n=>e.city=n)},[(m(!0),_(k,null,M(o.CITY_LIST,n=>(m(),_("option",{key:n.value,value:n.value},T(n.label),9,ot))),128))],512),[[R,e.city]]),C(d("select",{name:"",id:"","onUpdate:modelValue":t[1]||(t[1]=n=>e.bikeRoute=n)},[(m(!0),_(k,null,M(e.routeList,n=>(m(),_("option",{key:n.RouteName,value:n.RouteName},T(n.RouteName),9,at))),128))],512),[[R,e.bikeRoute]])])],64)}var st=S(Xe,[["render",nt],["__scopeId","data-v-3aad47fd"]]);const rt={components:{MapRoute:st},setup(){}};function it(e,t,a,o,s,c){const n=$("map-route");return m(),de(n)}var ct=S(rt,[["render",it]]);const lt={props:{availableList:{type:Array,default:()=>[]},isSearchExist:{type:Boolean,default:!1}},emits:["getNearByInfo"],setup(e,{emit:t}){let a=null,o=null,s=null,c=null,n=null;const u=()=>{let i="pk.eyJ1Ijoiam9lY2hhbmcxMDE0IiwiYSI6ImNrdno1ZnM3OTRtM2YzMG8wYnA2NGxpZzEifQ.EDTMLv4rcckA89UjJNWgXQ";a=p.map("map"),p.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:i}).addTo(a),o=new p.MarkerClusterGroup().addTo(a),e.isSearchExist&&y()},y=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(i=>{const h=i.coords.longitude,f=i.coords.latitude;console.log("longitude",h),console.log("latitude",f),g(f,h),t("getNearByInfo",{longitude:h,latitude:f})},i=>{const{code:h,message:f}=i;console.log("error",`code=${h}, msg=${f}`)})},g=(i,h)=>{a.setView([i,h],18),p.marker([i,h],{icon:s}).addTo(a).bindPopup("\u4F60\u5728\u9019\uFF5E").openPopup()},v=()=>{c=new p.Icon({iconUrl:"./images/mark/no-rent.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),n=new p.Icon({iconUrl:"./images/mark/bike.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),s=new p.Icon({iconUrl:"./images/mark/currentLocation.png",shadowUrl:"",iconSize:[40,41],iconAnchor:[12,41],popupAnchor:[1,-34]})},r=i=>new Date(i).toString("Zh_tw"),l=()=>{e.availableList.forEach(i=>{let{PositionLat:h,PositionLon:f}=i.StationPosition,{AvailableRentBikes:j,AvailableReturnBikes:F,UpdateTime:J,StationName:Q,StationAddress:X}=i;const W=j>0?n:c;o.addLayer(p.marker([h,f],{icon:W}).bindPopup(`
                <h2 class="title">${Q.Zh_tw}</h2>
                <h4>\u5730\u5740:${X.Zh_tw}</h4>
                <h4>\u53EF\u501F\u8173\u8E0F\u8ECA\u6578:${j}</h4>
                <h4>\u53EF\u9084\u8173\u8E0F\u8ECA\u6578:${F}</h4>
                <h4>\u66F4\u65B0\u6642\u9593:${r(J)}</h4>
                <a target="_blank" href='https://www.google.com/maps/search/?api=1&query=${h},${f}'>\u5728google map\u4E0A\u67E5\u770B</a>`))}),a.addLayer(o)};return U(()=>{v(),u()}),Z(()=>{a=null}),{drawSelfMark:g,drawMark:l}}},ut={id:"map",class:"w-screen h-screen"};function dt(e,t,a,o,s,c){return m(),_("div",ut)}var pt=S(lt,[["render",dt]]);const mt={components:{Map:pt},setup(){const e=pe(null),t=me(),a=he(()=>o.keyword||o.city),o=I({keyword:"",city:""}),s=I([]),c=async({longitude:y,latitude:g})=>{console.log("getNearByInfo",y,g);const v={city:o.city,filter:o.keyword?`contains(StationAddress.Zh_tw,'${o.keyword}') or contains(StationName.Zh_tw,'${o.keyword}')`:"",$spatialFilter:`nearby(${g},${y},${500})`};try{const r=await Je(v);console.log("station",r),Object.assign(s,r),u(y,g)}catch(r){console.log("error",r)}},n=I([]),u=async(y,g)=>{const v={$spatialFilter:`nearby(${g},${y},${500})`};try{const r=await Qe(v);r.forEach(l=>{s.forEach(i=>{i.StationUID===l.StationUID&&(l.StationName=i.StationName,l.StationPosition=i.StationPosition,l.StationAddress=i.StationAddress)})}),Object.assign(n,r),console.log("availableList",n),e.value.drawMark()}catch(r){console.log("error",r)}};return U(()=>{const y=t.query.city;y&&(o.city=y);const g=t.query.keyword;g&&(o.keyword=g)}),L(w({},P(o)),{isSearchExist:a,getNearByInfo:c,availableList:n,mapInstance:e})}};function ht(e,t,a,o,s,c){const n=$("Map");return m(),_("div",null,[b(n,{ref:"mapInstance",onGetNearByInfo:o.getNearByInfo,isSearchExist:o.isSearchExist,availableList:o.availableList},null,8,["onGetNearByInfo","isSearchExist","availableList"])])}var _t=S(mt,[["render",ht]]);const gt=[{path:"/",name:"Index",component:qe},{path:"/routemap",name:"RouteMap",component:ct},{path:"/bikemap",name:"BikeMap",component:_t}],yt=_e({history:ge(),routes:gt});function ft(e){const a={tId:adminUse.Cookie("cAa")};e.commit("updLoading",!0),adminUse.getAjax(e.state.config.groupPath.platformAdmin+"/backLogOut",a).then(o=>{e.commit("updLoading",!1),o.resultCode=="000"?(adminUse.Cookie("remove","cAa"),e.commit("updMenuList",""),e.commit("updUserName",""),e.commit("updIsLogin",!1),adminUse.showToast(o.msg),router.push("/login")):adminUse.showToast(o.msg+"("+o.resultCode+")","red")})}var vt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",logout:ft});const wt=new ye({storage:window.localStorage,reducer:e=>({myPlatformId:e.myPlatformId})}),bt=()=>({config:{}});var kt=fe({state:bt,mutations:{updBeep(e,t){e.beep=t}},actions:vt,plugins:[wt.plugin],modules:{}});const K=ve(Te);K.component("BootstrapIcon",we);K.use(kt).use(yt).mount("#app");
