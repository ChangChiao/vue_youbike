var Se=Object.defineProperty,ke=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var ye=(t,o,a)=>o in t?Se(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,A=(t,o)=>{for(var a in o||(o={}))Le.call(o,a)&&ye(t,a,o[a]);if(ue)for(var a of ue(o))$e.call(o,a)&&ye(t,a,o[a]);return t},X=(t,o)=>ke(t,xe(o));import{u as ge,r as b,o as y,c as m,a as r,F as j,b as ee,d as S,w as Pe,e as z,f as O,t as M,g as re,T as Ce,p as ie,h as ce,i as Z,j as U,k as J,l as E,m as le,n as Ie,q as Ae,s as N,v as he,L as w,x as Me,y as Te,z as te,A as oe,B as ae,C as me,D as Ue,E as Ne,G as Re,V as Be,H as De,I as Q,J as Ke,K as je,M as Ve,N as ze,O as Oe,P as Ee,Q as He,R as Ye}from"./vendor.377faac5.js";const Ge=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}};Ge();var _e="./images/logo.png";var T=(t,o)=>{for(const[a,e]of o)t[a]=e;return t};const Ze={setup(){const t=ge();return{menuList:[{title:"\u5C0B\u627E\u55AE\u8ECA",path:"/bike"},{title:"\u5C0B\u627E\u8ECA\u9053",path:"/route"}],goHome:()=>{t.push("/")}}}},Fe={class:"flex relative z-50 justify-between shadow-lg items-center px-3 font-medium h-20"},qe={class:"menu flex"};function Je(t,o,a,e,s,i){const c=b("router-link");return y(),m("header",Fe,[r("img",{class:"w-20 cursor-pointer",src:_e,alt:"",onClick:o[0]||(o[0]=(...n)=>e.goHome&&e.goHome(...n))}),r("ul",qe,[(y(!0),m(j,null,ee(e.menuList,n=>(y(),m("li",{class:"mx-3 :mdtext-lg text-md text-primary-500",key:n.path},[S(c,{to:n.path,class:"duration-200"},{default:Pe(()=>[O(M(n.title),1)]),_:2},1032,["to"])]))),128))]),z(` <font-awesome-icon\r
            class="for-mobile text-lg text-gray-500"\r
            icon="search"\r
        /> `)])}var Qe=T(Ze,[["render",Je],["__scopeId","data-v-61dd7a3d"]]);const We={props:{showLoading:{type:Boolean,default:null}},setup(){}},Xe=t=>(ie("data-v-efe9d588"),t=t(),ce(),t),et={key:0,class:"loading-wrap"},tt=Xe(()=>r("svg",{class:"spinner",width:"65px",height:"65px",viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"},[r("circle",{class:"path",fill:"none","stroke-width":"6","stroke-linecap":"round",cx:"33",cy:"33",r:"30"})],-1)),ot=[tt];function at(t,o,a,e,s,i){return y(),re(Ce,{to:"#teleport-target"},[a.showLoading?(y(),m("div",et,ot)):z("v-if",!0)])}var st=T(We,[["render",at],["__scopeId","data-v-efe9d588"]]);const nt={components:{Loading:st,Header:Qe},setup(){const t=Z(!1),o=Z(0);return U("setShowLoading",e=>{t.value=e}),U("isMobile",o),J(()=>{o.value=window.innerWidth<768}),{showLoading:t}}};function rt(t,o,a,e,s,i){const c=b("Header"),n=b("router-view"),_=b("loading");return y(),m(j,null,[S(c),S(n),S(_,{showLoading:e.showLoading},null,8,["showLoading"])],64)}var it=T(nt,[["render",rt]]);const Y="https://tdx.transportdata.tw/api/basic/v2",ct="https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",lt=Y+"/Bike/Station/City",dt=Y+"/Bike/Availability/City",pt=Y+"/Cycling/Shape/City",ut=Y+"/Bike/Station/NearBy",yt=Y+"/Bike/Availability/NearBy",gt=Y+"/Tourism/ScenicSpot",ht=Y+"/Tourism/Restaurant",se=[{label:"\u81FA\u5317\u5E02",value:"Taipei"},{label:"\u65B0\u5317\u5E02",value:"NewTaipei"},{label:"\u6843\u5712\u5E02",value:"Taoyuan"},{label:"\u81FA\u4E2D\u5E02",value:"Taichung"},{label:"\u81FA\u5357\u5E02",value:"Tainan"},{label:"\u9AD8\u96C4\u5E02",value:"Kaohsiung"},{label:"\u82D7\u6817\u7E23",value:"MiaoliCounty"},{label:"\u5609\u7FA9\u5E02",value:"Chiayi"},{label:"\u5C4F\u6771\u7E23",value:"PingtungCounty"},{label:"\u91D1\u9580\u7E23",value:"KinmenCounty"}],mt={props:{city:{type:String,default:""},keyword:{type:String,default:""}},emits:["updateCity","updateKeyword","search"],setup(t,{emit:o}){return{CITY_LIST:se,updateKeyword:i=>{o("updateKeyword",i.target.value)},updateCity:i=>{o("updateCity",i.target.value)},search:()=>{o("search")}}}},_t={class:"input-box py-2"},wt=["value"],ft={class:"flex pt-3"},vt=["value"],bt=["value"];function St(t,o,a,e,s,i){const c=b("font-awesome-icon");return y(),m(j,null,[r("div",_t,[S(c,{class:"text-gray-500",icon:"search"}),r("input",{class:"w-1/2 pl-4",placeholder:"\u8F38\u5165\u95DC\u9375\u5B57",value:a.keyword,onInput:o[0]||(o[0]=(...n)=>e.updateKeyword&&e.updateKeyword(...n)),type:"text"},null,40,wt)]),r("div",ft,[r("select",{class:"w-1/2",value:a.city,onChange:o[1]||(o[1]=(...n)=>e.updateCity&&e.updateCity(...n))},[z(' <option value="">\u7E23\u5E02</option> '),(y(!0),m(j,null,ee(e.CITY_LIST,n=>(y(),m("option",{key:n.value,value:n.value},M(n.label),9,bt))),128))],40,vt),r("button",{onClick:o[2]||(o[2]=(...n)=>e.search&&e.search(...n)),class:"ml-2 w-1/2 cursor-pointer"},"\u641C\u5C0B")])],64)}var de=T(mt,[["render",St]]),kt="./images/illustration.png";const xt={components:{Search:de},setup(){const t=ge(),o=E({city:se[0].value,keyword:""}),a=i=>{o.city=i},e=i=>{o.keyword=i},s=()=>{t.push({path:"/bike",query:{keyword:o.keyword,city:o.city}})};return X(A({},le(o)),{search:s,updateCity:a,updateKeyword:e})}},ne=t=>(ie("data-v-c221866a"),t=t(),ce(),t),Lt={class:"cover relative bg-primary-100"},$t={class:"search w-4/5 m-auto md:ml-40 pt-12 md:w-96 relative z-10"},Pt=ne(()=>r("img",{class:"w-60",src:_e,alt:""},null,-1)),Ct=ne(()=>r("p",{class:"text-2xl text-primary-500 font-extrabold"},"\u5C0B\u627E\u55AE\u8ECA,",-1)),It=ne(()=>r("p",{class:"text-2xl text-primary-500 font-extrabold pb-4"}," \u4F86\u5834\u60A0\u9592\u7684\u653E\u9B06\u4E4B\u65C5\uFF01 ",-1)),At=ne(()=>r("img",{class:"fixed bottom-10 md:w-2/3 left-0 right-0 mx-auto md:bottom-40",src:kt},null,-1));function Mt(t,o,a,e,s,i){const c=b("Search");return y(),m("div",Lt,[r("div",$t,[Pt,Ct,It,S(c,{onUpdateCity:e.updateCity,onUpdateKeyword:e.updateKeyword,onSearch:e.search,city:t.city,keyword:t.keyword},null,8,["onUpdateCity","onUpdateKeyword","onSearch","city","keyword"])]),At])}var Tt=T(xt,[["render",Mt],["__scopeId","data-v-c221866a"]]);const Ut=(t,o="success")=>{t&&console.log(t,o)},pe=t=>{let o=new Date(t);return Ie(o).format("YYYY-MM-DD HH:mm:ss")},F=(t,o)=>{let a="",e="";switch(t){case 0:a="no-available",e="\u505C\u6B62\u71DF\u904B";break;case 1:a="available",e="\u6B63\u5E38\u71DF\u904B";break;case 2:a="no-rent",e="\u66AB\u505C\u71DF\u904B";break}return o==="color"?a:e},B=Ae.create({});B.interceptors.request.use(t=>{var a;let o=(a=t.params)!=null?a:t.data;return Object.keys(o).map(e=>{o[e]||delete o[e]}),t},t=>t);B.interceptors.response.use(t=>t.data,async t=>{var a;const o=(a=t==null?void 0:t.response)==null?void 0:a.status;if(Ut(`error--${o}`,"error"),console.log("status",typeof o),o===403||o===429){const e=await zt();console.log("res",e),e.access_token&&localStorage.setItem("token",e.access_token)}return Promise.reject(t)});let we=0;const G=()=>({authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/x-www-form-urlencoded"}),W=t=>{const{city:o}=t;return delete t.city,{cityPath:o,data:t}},Nt=t=>{const{cityPath:o,data:a}=W(t);let e={headers:G(),params:A({},a)};return B.get(lt+`/${o}`,e)},Rt=t=>{const{cityPath:o,data:a}=W(t);let e={headers:G(),params:A({},a)};return B.get(dt+`/${o}`,e)},Bt=t=>{const{cityPath:o,data:a}=W(t);let e={headers:G(),params:A({},a)};return B.get(pt+`/${o}`,e)},Dt=t=>{let o={headers:G(),params:A({},t)};return B.get(ut,o)},Kt=t=>{let o={headers:G(),params:A({},t)};return B.get(yt,o)},jt=t=>{const{cityPath:o,data:a}=W(t);let e={headers:G(),params:A({},a)};return B.get(ht+`/${o}`,e)},Vt=t=>{const{cityPath:o,data:a}=W(t);let e={headers:G(),params:A({},a)};return B.get(gt+`/${o}`,e)},zt=()=>{if(Date.now()-we<3e3)return Promise.reject("fail");we=Date.now();const t={grant_type:"client_credentials",client_id:"t7552175-83b00a85-f388-4d75",client_secret:"40b1e2e1-e589-493c-891a-a0eca36c75b5"};let o={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return B.post(ct,new URLSearchParams(t),o)},Ot={emit:[],setup(){const t=N("showStatus"),o=N("setShowStatus");return{showStatus:t,controlStatus:()=>{o(!1)}}}},Et={class:"fixed for-mobile-flex flex-wrap flex justify-center items-center w-screen h-12 shadow-lg bottom-0 bg-white z-10"};function Ht(t,o,a,e,s,i){return y(),m("div",Et,[r("button",{class:"h-8 w-1/2 text-primary-500 text-sm available",onClick:o[0]||(o[0]=c=>e.controlStatus())}," \u986F\u793A\u5217\u8868 ")])}var fe=T(Ot,[["render",Ht]]);const Yt={components:{ViewBar:fe},props:{city:{type:String,default:""}},emits:["getRoute"],setup(t,{emit:o}){const a=N("isMobile");let e=null,s=null,i=null,c=null,n=null;const _=()=>{let u="pk.eyJ1Ijoiam9lY2hhbmcxMDE0IiwiYSI6ImNrdno1ZnM3OTRtM2YzMG8wYnA2NGxpZzEifQ.EDTMLv4rcckA89UjJNWgXQ";e=w.map("map_route"),w.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:u}).addTo(e),n=new w.MarkerClusterGroup().addTo(e),d()},l=()=>{n.clearLayers(),e.eachLayer(u=>{u instanceof w.Marker&&e.removeLayer(u)})},D=u=>{let h=u.replace("MULTILINESTRING ((","").replace("))","").split(",");const $=h[0]&&h[0].split(" "),I=h[h.length-1]&&h[h.length-1].split(" ");n.addLayer(w.marker([$[1],$[0]],{icon:s})),n.addLayer(w.marker([I[1],I[0]],{icon:s})),e.addLayer(n),R($[1],$[0]),K($[1],$[0])},C=(u,k)=>{u.forEach(v=>{const{PositionLon:h,PositionLat:$}=v.Position;let I=k==="food"?i:c;n.addLayer(w.marker([$,h],{icon:I}).bindPopup(`<h1>${v.Name}</h1>
                        <p>${v.OpenTime}</p>
                        `))}),e.addLayer(n)},R=async(u,k)=>{const v={city:t.city,$spatialFilter:`nearby(${u},${k},${500})`};try{const h=await Vt(v);C(h,"spot")}catch(h){console.log("error",h)}},K=async(u,k)=>{try{const v={city:t.city,$spatialFilter:`nearby(${u},${k},${500})`},h=await jt(v);C(h,"food")}catch(v){console.log("error",v)}},d=()=>{o("getRoute")},f=()=>{s=new w.Icon({iconUrl:"./images/mark/no_rent.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),i=new w.Icon({iconUrl:"./images/mark/food.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),c=new w.Icon({iconUrl:"./images/mark/spot.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]})},x=u=>{console.log("Geometry",u),l();const k=new Me.exports.Wkt;k.read(u);const v=k.toJson(),h={color:"#C50047",weight:5};n=w.geoJSON(v,{style:h}).addTo(e),n.addData(v),e.fitBounds(n.getBounds()),e.addLayer(n),D(u)};return J(()=>{f(),_()}),he(()=>{e=null,n=null}),{drawLine:x,isMobile:a}}},Gt=t=>(ie("data-v-3aad47fd"),t=t(),ce(),t),Zt=Gt(()=>r("div",{id:"map_route",class:"map fixed z-10"},null,-1));function Ft(t,o,a,e,s,i){const c=b("ViewBar");return y(),m(j,null,[Zt,e.isMobile?(y(),re(c,{key:0})):z("v-if",!0)],64)}var qt=T(Yt,[["render",Ft],["__scopeId","data-v-3aad47fd"]]);const Jt={components:{VPagination:Te},setup(){const t=N("page"),o=N("totalPage"),a=N("setPage");return{page:t,totalPage:o,updateHandler:s=>{a(s)}}}},Qt={class:"pt-4 flex justify-center"};function Wt(t,o,a,e,s,i){const c=b("v-pagination");return y(),m("div",Qt,[S(c,{"v-model":e.page,pages:e.totalPage,"range-size":1,"active-color":"#DCEDFF","onUpdate:modelValue":e.updateHandler},null,8,["v-model","pages","onUpdate:modelValue"])])}var ve=T(Jt,[["render",Wt]]);const Xt={components:{Pagination:ve,Search:de},props:{singlePageList:{type:Array,default:()=>[]},keyword:{type:String,default:""},city:{type:String,default:""}},emits:["drawLine","updateKeyword","updateCity","search"],setup(t,{emit:o}){const a=N("setShowStatus"),e=()=>{a(!0)};return{drawLine:_=>{o("drawLine",_),e()},updateCity:_=>{o("updateCity",_)},updateKeyword:_=>{o("updateKeyword",_)},search:()=>{o("search")}}}},eo={class:"h-full md:w-96 w-full fixed px-8 left-0 top-0 z-20 box-border pt-24 overflow-hidden bg-white"},to={class:"rounded-xl shadow-lg overflow-hidden"},oo=r("div",{class:"md:h-8 hidden md:block bg-primary-500"},null,-1),ao={class:"p-4"},so=r("h1",{class:"md:text-3xl hidden md:block font-bold mb-6"}," \u5C0B\u627E\u8ECA\u9053 ",-1),no={class:"list overflow-y-scroll mt-8 md:mb-4"},ro={class:""},io=["onClick"],co={class:"text-xl font-bold pb-2"},lo={class:"mr-8"},po=r("span",{class:"sub-title"},"\u958B\u59CB",-1),uo=r("span",{class:"sub-title"},"\u7D50\u675F",-1);function yo(t,o,a,e,s,i){const c=b("Search"),n=b("font-awesome-icon"),_=b("pagination");return y(),m("div",eo,[r("div",to,[oo,r("div",ao,[so,S(c,{onSearch:e.search,onUpdateCity:e.updateCity,onUpdateKeyword:e.updateKeyword,city:a.city,keyword:a.keyword},null,8,["onSearch","onUpdateCity","onUpdateKeyword","city","keyword"])])]),r("div",no,[r("ul",ro,[(y(!0),m(j,null,ee(a.singlePageList,l=>(y(),m("li",{class:"bg-grey-100 rounded-xl mb-3 px-2 py-4 cursor-pointer",key:l.StationUID,onClick:D=>e.drawLine(l.Geometry)},[r("h3",co,M(l.RouteName),1),r("h4",null,[S(n,{class:"text-primary-500",icon:"map-marker-alt"}),O(" "+M(l.City)+" "+M(l.Town||""),1)]),r("p",null,[r("span",lo,[S(n,{class:"text-primary-500 mr-2",icon:"exchange-alt"}),O(M(l.Direction||"\u55AE\u5411"),1)]),r("span",null,[S(n,{class:"text-primary-500 mr-2",icon:"route"}),O(M(l.CyclingLength)+"\u516C\u5C3A",1)])]),r("p",null,[po,O(M(l.RoadSectionStart),1)]),r("p",null,[uo,O(M(l.RoadSectionEnd),1)]),z(" <button >\u67E5\u770B\u4F4D\u7F6E</button> ")],8,io))),128))])]),S(_)])}var go=T(Xt,[["render",yo]]);const ho={components:{MapRoute:qt,RouteList:go},setup(){const t=Z(null),o=Z(!1),a=E([]),e=N("isMobile"),s=E({keyword:"",city:se[0].value,page:1,totalPage:1}),i=d=>{s.city=d},c=d=>{s.keyword=d},n=E([]),_=async()=>{n.length=0,a.length=0,console.log("singlePageList--route",a);const d={city:s.city,$filter:s.keyword?`contains(RouteName,'${s.keyword}')`:""};try{const f=await Bt(d);f.length>0&&(Object.assign(n,f),s.totalPage=Math.ceil(n.length/30),s.page=1,K())}catch(f){console.log("error",f)}},l=d=>{s.page=d,K()},D=()=>{_()},C=d=>{t.value.drawLine(d)},R=d=>{o.value=d};U("totalPage",te(s,"totalPage")),U("page",te(s,"page")),U("setPage",l),U("showStatus",o),U("setShowStatus",R);const K=()=>{const d=[...n],f=(s.page-1)*30,x=d.splice(f,30);Object.assign(a,x);const u=a[0];C(u.Geometry)};return J(()=>{}),X(A({},le(s)),{updateCity:i,updateKeyword:c,singlePageList:a,getRoute:_,mapInstance:t,drawLine:C,search:D,isMobile:e,showStatus:o})}};function mo(t,o,a,e,s,i){const c=b("map-route"),n=b("route-list");return y(),m(j,null,[oe(S(c,{ref:"mapInstance",city:t.city,singlePageList:e.singlePageList,onGetRoute:e.getRoute},null,8,["city","singlePageList","onGetRoute"]),[[ae,e.showStatus||!e.isMobile]]),oe(S(n,{onSearch:e.search,onDrawLine:e.drawLine,onUpdateCity:e.updateCity,onUpdateKeyword:e.updateKeyword,singlePageList:e.singlePageList,keyword:t.keyword,city:t.city},null,8,["onSearch","onDrawLine","onUpdateCity","onUpdateKeyword","singlePageList","keyword","city"]),[[ae,!e.showStatus||!e.isMobile]])],64)}var _o=T(ho,[["render",mo]]);const wo={components:{ViewBar:fe},props:{singlePageList:{type:Array,default:()=>[]}},emits:["mapReady"],setup(t,{emit:o}){const a=N("isMobile");let e=null,s=null,i=null,c=null,n=null;const _=()=>{let d="pk.eyJ1Ijoiam9lY2hhbmcxMDE0IiwiYSI6ImNrdno1ZnM3OTRtM2YzMG8wYnA2NGxpZzEifQ.EDTMLv4rcckA89UjJNWgXQ";e=w.map("map"),w.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:d}).addTo(e),s=new w.MarkerClusterGroup().addTo(e),o("mapReady")},l=()=>{s.clearLayers(),e.eachLayer(d=>{d instanceof w.Marker&&e.removeLayer(d)})},D=(d,f)=>{e.setView([d,f],18),w.marker([d,f],{icon:i}).addTo(e).bindPopup("\u4F60\u5728\u9019\uFF5E").openPopup()},C=d=>{let{PositionLat:f,PositionLon:x}=d.StationPosition,{AvailableRentBikes:u,AvailableReturnBikes:k,UpdateTime:v,StationName:h,StationAddress:$,ServiceStatus:I}=d;w.popup().setLatLng([f,x]).openOn(e).setContent(`
            <h3 class="text-xl font-bold">
                ${h.Zh_tw}
            </h3>
            <h4 class="pt-2 text-sm">
                <i class="fas fa-map-marker-alt text-lg  text-primary-500"></i>
                ${$.Zh_tw}
            </h4>
            <p class="text-sm">
            <i class="fas fa-history text-lg text-primary-500"></i>
                ${pe(v)}
            </p>
            <p class="py-2">
                <span class="${F(I,"color")}">
                    ${F(I,"type")}
                </span>
                <span
                    class="
                        ${u>0?"available":"no-available"}
                    "
                    >
                        ${u>0?"\u5C1A\u6709\u55AE\u8ECA":"\u5DF2\u7121\u55AE\u8ECA"}
                    </span>
            </p>
            <div class="rent-info flex items-center justify-between">
                <div class="w-1/2 md:h-24 h-16 flex flex-col justify-center rounded-md border-primary-500 mr-4 text-center border">
                    <p class="font-bold my-1 text-primary-500 text-base">\u53EF\u501F\u55AE\u8ECA</p>
                    <p class="font-bold text-2xl">
                        ${u}
                    </p>
                </div>
                <div class="w-1/2 md:h-24 h-16 flex flex-col justify-center rounded-md border-primary-500 text-center border">
                    <p class="font-bold text-primary-500 text-base">\u53EF\u505C\u7A7A\u4F4D</p>
                    <p class="font-bold text-2xl">
                        ${k}
                    </p>
                </div>
            </div> `),e.setView([f,x],18)},R=()=>{c=new w.Icon({iconUrl:"./images/mark/no_rent.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),n=new w.Icon({iconUrl:"./images/mark/bike.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),i=new w.Icon({iconUrl:"./images/mark/currentLocation.png",shadowUrl:"",iconSize:[40,41],iconAnchor:[12,41],popupAnchor:[1,-34]})},K=d=>{l(),d.forEach(f=>{let{PositionLat:x,PositionLon:u}=f.StationPosition,{AvailableRentBikes:k,AvailableReturnBikes:v,UpdateTime:h,StationName:$,StationAddress:I,ServiceStatus:q}=f;const p=k>0?n:c;s.addLayer(w.marker([x,u],{icon:p}).bindPopup(`
                <h3 class="text-xl font-bold">
                    ${$.Zh_tw}
                </h3>
                <h4 class="pt-2 text-sm">
                    <i class="fas fa-map-marker-alt text-lg  text-primary-500"></i>
                    ${I.Zh_tw}
                </h4>
                <p class="text-sm">
                <i class="fas fa-history text-lg text-primary-500"></i>
                    ${pe(h)}
                </p>
                <p class="py-2">
                    <span class="${F(q,"color")}">
                        ${F(q,"type")}
                    </span>
                    <span
                        class="
                            ${k>0?"available":"no-available"}
                        "
                        >
                            ${k>0?"\u5C1A\u6709\u55AE\u8ECA":"\u5DF2\u7121\u55AE\u8ECA"}
                        </span>
                </p>
                <div class="rent-info flex items-center justify-between">
                    <div class="w-1/2 h-24 flex flex-col justify-center rounded-md border-primary-500 mr-4 text-center border">
                        <p class="font-bold my-1 text-primary-500 text-base">\u53EF\u501F\u55AE\u8ECA</p>
                        <p class="font-bold text-2xl">
                            ${k}
                        </p>
                    </div>
                    <div class="w-1/2 h-24 flex flex-col justify-center rounded-md border-primary-500 text-center border">
                        <p class="font-bold text-primary-500 text-base">\u53EF\u505C\u7A7A\u4F4D</p>
                        <p class="font-bold text-2xl">
                            ${v}
                        </p>
                    </div>
                </div> `))}),e.addLayer(s)};return J(()=>{R(),_()}),he(()=>{e=null,s=null}),{drawSelfMark:D,drawMark:K,setView:C,transType:F,transTime:pe,isMobile:a}}},fo=r("div",{id:"map",class:"map fixed z-10"},null,-1);function vo(t,o,a,e,s,i){const c=b("ViewBar");return y(),m(j,null,[fo,e.isMobile?(y(),re(c,{key:0})):z("v-if",!0)],64)}var bo=T(wo,[["render",vo]]);const So={components:{Pagination:ve,Search:de},props:{singlePageList:{type:Array,default:()=>[]},keyword:{type:String,default:""},city:{type:String,default:""}},emits:["setView","updateKeyword","updateCity","search","getNowPos"],setup(t,{emit:o}){const a=N("setShowStatus"),e=()=>{a(!0)};return{setView:l=>{o("setView",l),e()},updateCity:l=>{o("updateCity",l)},updateKeyword:l=>{o("updateKeyword",l)},search:()=>{o("search")},transType:F,getNowPos:()=>{o("getNowPos")}}}},ko={class:"h-full md:w-96 w-full fixed px-8 left-0 top-0 z-20 box-border pt-24 overflow-hidden bg-white"},xo={class:"rounded-xl shadow-lg overflow-hidden"},Lo=r("div",{class:"md:h-8 md:block hidden bg-primary-500"},null,-1),$o={class:"p-4"},Po={class:"md:text-3xl text-2xl font-bold md:mb-6 mb-2 flex justify-between items-center"},Co=O(" \u5C0B\u627E\u55AE\u8ECA "),Io={class:"list overflow-y-scroll mt-8 md:mb-4"},Ao={class:""},Mo={key:0,class:"text-center text-primary-500"},To=["onClick"],Uo={class:"text-xl font-bold"},No={class:"py-2"};function Ro(t,o,a,e,s,i){const c=b("Search"),n=b("font-awesome-icon"),_=b("pagination");return y(),m("div",null,[r("div",ko,[r("div",xo,[Lo,r("div",$o,[r("h1",Po,[Co,r("i",{class:"fas fa-crosshairs text-primary-300 cursor-pointer",onClick:o[0]||(o[0]=(...l)=>e.getNowPos&&e.getNowPos(...l))})]),S(c,{onSearch:e.search,onUpdateCity:e.updateCity,onUpdateKeyword:e.updateKeyword,city:a.city,keyword:a.keyword},null,8,["onSearch","onUpdateCity","onUpdateKeyword","city","keyword"])])]),r("div",Io,[r("ul",Ao,[a.singlePageList.length===0?(y(),m("li",Mo," \u67E5\u7121\u7D00\u9304 ")):z("v-if",!0),(y(!0),m(j,null,ee(a.singlePageList,l=>(y(),m("li",{class:"bg-grey-100 rounded-xl mb-3 px-2 py-4 cursor-pointer",key:l.StationUID,onClick:D=>e.setView(l)},[r("h3",Uo,M(l.StationName.Zh_tw),1),r("h4",null,[S(n,{icon:"map-marker-alt"}),O(" "+M(l.StationAddress.Zh_tw),1)]),r("p",No,[r("span",{class:me(e.transType(l.ServiceStatus,"color"))},M(e.transType(l.ServiceStatus,"type")),3),r("span",{class:me(l.AvailableRentBikes>0?"available":"no-available")},M(l.AvailableRentBikes>0?"\u5C1A\u6709\u55AE\u8ECA":"\u5DF2\u7121\u55AE\u8ECA"),3)]),z(" <button >\u67E5\u770B\u4F4D\u7F6E</button> ")],8,To))),128))])]),S(_)])])}var Bo=T(So,[["render",Ro]]);const Do={components:{MapBike:bo,BikeList:Bo},setup(){const t=Z(null),o=Z(!1),a=Ue(),e=N("isMobile"),s=E({keyword:"",city:se[0].value,page:1,totalPage:1}),i=p=>{s.city=p},c=p=>{s.keyword=p},n=()=>{const p=a.query.city;p&&(s.city=p);const g=a.query.keyword;g&&(s.keyword=g),d()},_=N("setShowLoading"),l=p=>{_(p)},D=()=>{d()},C=E([]);let R=E([]);const K=()=>{C.length=0,x.length=0,R.length=0},d=async()=>{K();const p={city:s.city,$filter:s.keyword?`contains(StationName/Zh_tw,'${s.keyword}')`:""};try{const g=await Nt(p);Object.assign(C,g),g.length>0&&u()}catch(g){console.log("error",g)}},f=async({longitude:p,latitude:g})=>{K();const P={city:s.city,$spatialFilter:`nearby(${g},${p},${500})`};try{const L=await Dt(P);Object.assign(C,L),L.length>0&&k(p,g)}catch(L){console.log("error",L)}},x=E([]),u=async()=>{l(!0);const p={city:s.city};try{const g=await Rt(p);let P=C.filter(L=>g.some(V=>L.StationUID===V.StationUID));P.forEach((L,V)=>{g.forEach(H=>{L.StationUID===H.StationUID&&(P[V]=A(A({},L),H))})}),Object.assign(x,P),s.totalPage=Math.ceil(x.length/30),s.page=1,I()}catch(g){console.log("error",g)}l(!1)},k=async(p,g)=>{l(!0);const P={$spatialFilter:`nearby(${g},${p},${500})`};try{const L=await Kt(P);L.forEach(V=>{C.forEach(H=>{H.StationUID===V.StationUID&&(V.StationName=H.StationName,V.StationPosition=H.StationPosition,V.StationAddress=H.StationAddress)})}),Object.assign(x,L),s.totalPage=Math.ceil(x.length/30),s.page=1,I()}catch(L){console.log("error",L)}l(!1)},v=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(p=>{const g=p.coords.longitude,P=p.coords.latitude;t.value.drawSelfMark(P,g),f({longitude:g,latitude:P})},p=>{const{code:g,message:P}=p;console.log("error",`code=${g}, msg=${P}`),d()})},h=p=>{s.page=p,I()},$=p=>{o.value=p};U("totalPage",te(s,"totalPage")),U("page",te(s,"page")),U("setPage",h),U("showStatus",o),U("setShowStatus",$);const I=()=>{const p=[...x],g=(s.page-1)*30,P=p.splice(g,30);Object.assign(R,P),t.value.drawMark(R);const L=R[0];q(L)},q=p=>{t.value.setView(p)};return J(()=>{}),X(A({},le(s)),{getNearByInfo:f,availableList:x,mapReady:n,mapInstance:t,updateCity:i,singlePageList:R,updateKeyword:c,setView:q,search:D,showStatus:o,isMobile:e,getNowPos:v})}};function Ko(t,o,a,e,s,i){const c=b("map-bike"),n=b("bike-list");return y(),m("div",null,[oe(S(c,{ref:"mapInstance",singlePageList:e.singlePageList,onMapReady:e.mapReady},null,8,["singlePageList","onMapReady"]),[[ae,e.showStatus||!e.isMobile]]),oe(S(n,{onSearch:e.search,onSetView:e.setView,onUpdateCity:e.updateCity,onUpdateKeyword:e.updateKeyword,onGetNowPos:e.getNowPos,singlePageList:e.singlePageList,city:t.city,keyword:t.keyword},null,8,["onSearch","onSetView","onUpdateCity","onUpdateKeyword","onGetNowPos","singlePageList","city","keyword"]),[[ae,!e.showStatus||!e.isMobile]])])}var jo=T(Do,[["render",Ko]]);const Vo=[{path:"/",name:"Index",component:Tt},{path:"/route",name:"Route",component:_o},{path:"/bike",name:"Bike",component:jo}],zo=Ne({history:Re(),routes:Vo});function Oo(t){const a={tId:adminUse.Cookie("cAa")};t.commit("updLoading",!0),adminUse.getAjax(t.state.config.groupPath.platformAdmin+"/backLogOut",a).then(e=>{t.commit("updLoading",!1),e.resultCode=="000"?(adminUse.Cookie("remove","cAa"),t.commit("updMenuList",""),t.commit("updUserName",""),t.commit("updIsLogin",!1),adminUse.showToast(e.msg),router.push("/login")):adminUse.showToast(e.msg+"("+e.resultCode+")","red")})}var Eo=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",logout:Oo});const Ho=new Be({storage:window.localStorage,reducer:t=>({myPlatformId:t.myPlatformId})}),Yo=()=>({config:{}});var Go=De({state:Yo,mutations:{updBeep(t,o){t.beep=o}},actions:Eo,plugins:[Ho.plugin],modules:{}});Q.add(Ke);Q.add(je);Q.add(Ve);Q.add(ze);Q.add(Oe);const be=Ee(it);be.component("font-awesome-icon",He);be.use(Go).use(zo).use(Ye).mount("#app");
