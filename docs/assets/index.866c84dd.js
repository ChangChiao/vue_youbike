var ge=Object.defineProperty,ye=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var se=(t,o,e)=>o in t?ge(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,T=(t,o)=>{for(var e in o||(o={}))he.call(o,e)&&se(t,e,o[e]);if(ne)for(var e of ne(o))me.call(o,e)&&se(t,e,o[e]);return t},H=(t,o)=>ye(t,_e(o));import{u as re,r as S,o as h,c as f,a as i,F as B,b as Z,d as b,w as we,e as M,t as L,f as ie,g as Y,T as fe,p as W,h as ee,i as te,j as K,k as R,l as oe,m as ve,n as ke,q as G,s as ce,L as m,v as be,x as Se,y as F,z as q,A as xe,B as le,C as Le,D as $e,E as Pe,V as Ae,G as Ie,H as z,I as Ce,J as Te,K as Me,M as Ue,N as Be,O as Re,P as Ne,Q as Ke}from"./vendor.afbea5a4.js";const De=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}};De();var de="./images/logo.png";var C=(t,o)=>{for(const[e,a]of o)t[e]=a;return t};const Ve={setup(){const t=re();return{menuList:[{title:"\u5C0B\u627E\u55AE\u8ECA",path:"/bike"},{title:"\u5C0B\u627E\u8ECA\u9053",path:"/route"}],goHome:()=>{t.push("/")}}}},ze={class:"flex relative z-50 justify-between shadow-lg items-center px-3 font-medium h-20"},Oe={class:"menu flex"};function Ee(t,o,e,a,s,r){const n=S("router-link");return h(),f("header",ze,[i("img",{class:"w-20",src:de,alt:"",onClick:o[0]||(o[0]=(...l)=>a.goHome&&a.goHome(...l))}),i("ul",Oe,[(h(!0),f(B,null,Z(a.menuList,l=>(h(),f("li",{class:"mx-3 text-lg text-primary-500",key:l.path},[b(n,{to:l.path,class:"duration-200"},{default:we(()=>[M(L(l.title),1)]),_:2},1032,["to"])]))),128))])])}var je=C(Ve,[["render",Ee],["__scopeId","data-v-61dd7a3d"]]);const He={props:{showLoading:{type:Boolean,default:null}},setup(){}},Ze=t=>(W("data-v-efe9d588"),t=t(),ee(),t),Ye={key:0,class:"loading-wrap"},Ge=Ze(()=>i("svg",{class:"spinner",width:"65px",height:"65px",viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"},[i("circle",{class:"path",fill:"none","stroke-width":"6","stroke-linecap":"round",cx:"33",cy:"33",r:"30"})],-1)),Fe=[Ge];function qe(t,o,e,a,s,r){return h(),ie(fe,{to:"#teleport-target"},[M(L(e.showLoading)+" ",1),e.showLoading?(h(),f("div",Ye,Fe)):Y("v-if",!0)])}var Je=C(He,[["render",qe],["__scopeId","data-v-efe9d588"]]);const Qe={components:{Loading:Je,Header:je},setup(){const t=te(!1);return K("setShowLoading",e=>{t.value=e}),{showLoading:t}}};function Xe(t,o,e,a,s,r){const n=S("Header"),l=S("router-view"),$=S("loading");return h(),f(B,null,[b(n),b(l),b($,{showLoading:a.showLoading},null,8,["showLoading"])],64)}var We=C(Qe,[["render",Xe]]);const D="https://ptx.transportdata.tw/MOTC/v2",et=D+"/Bike/Station",tt=D+"/Bike/Availability",ot=D+"/Cycling/Shape",at=D+"/Bike/Station/NearBy",nt=D+"/Bike/Availability/NearBy",st=D+"/ScenicSpot",rt=D+"/Restaurant",J=[{label:"\u81FA\u5317\u5E02",value:"Taipei"},{label:"\u65B0\u5317\u5E02",value:"NewTaipei"},{label:"\u6843\u5712\u5E02",value:"Taoyuan"},{label:"\u81FA\u4E2D\u5E02",value:"Taichung"},{label:"\u81FA\u5357\u5E02",value:"Tainan"},{label:"\u9AD8\u96C4\u5E02",value:"Kaohsiung"},{label:"\u82D7\u6817\u7E23",value:"MiaoliCounty"},{label:"\u5609\u7FA9\u5E02",value:"Chiayi"},{label:"\u5C4F\u6771\u7E23",value:"PingtungCounty"},{label:"\u91D1\u9580\u7E23",value:"KinmenCounty"}],it={props:{city:{type:String,default:""},keyword:{type:String,default:""}},emits:["updateCity","updateKeyword","search"],setup(t,{emit:o}){return{CITY_LIST:J,updateKeyword:r=>{o("updateKeyword",r.target.value)},updateCity:r=>{o("updateCity",r.target.value)},search:()=>{o("search")}}}},ct={class:"input-box py-2"},lt=["value"],dt={class:"flex pt-3"},pt=["value"],ut=i("option",{value:""},"\u7E23\u5E02",-1),gt=["value"];function yt(t,o,e,a,s,r){const n=S("font-awesome-icon");return h(),f(B,null,[i("div",ct,[b(n,{class:"text-gray-500",icon:"search"}),i("input",{class:"w-1/2 pl-4",placeholder:"\u8F38\u5165\u95DC\u9375\u5B57",value:e.keyword,onInput:o[0]||(o[0]=(...l)=>a.updateKeyword&&a.updateKeyword(...l)),type:"text"},null,40,lt)]),i("div",dt,[i("select",{class:"w-1/2",value:e.city,onChange:o[1]||(o[1]=(...l)=>a.updateCity&&a.updateCity(...l))},[ut,(h(!0),f(B,null,Z(a.CITY_LIST,l=>(h(),f("option",{key:l.value,value:l.value},L(l.label),9,gt))),128))],40,pt),i("button",{onClick:o[2]||(o[2]=(...l)=>a.search&&a.search(...l)),class:"ml-2 w-1/2"},"\u641C\u5C0B")])],64)}var ae=C(it,[["render",yt]]),_t="./images/illustration.png";const ht={components:{Search:ae},setup(){const t=re(),o=R({city:J[0].value,keyword:""}),e=r=>{o.city=r},a=r=>{o.keyword=r},s=()=>{t.push({path:"/bike",query:{keyword:o.keyword,city:o.city}})};return H(T({},oe(o)),{search:s,updateCity:e,updateKeyword:a})}},Q=t=>(W("data-v-c221866a"),t=t(),ee(),t),mt={class:"cover relative bg-primary-100"},wt={class:"search w-4/5 m-auto md:ml-40 pt-12 md:w-96 relative z-10"},ft=Q(()=>i("img",{class:"w-60",src:de,alt:""},null,-1)),vt=Q(()=>i("p",{class:"text-2xl text-primary-500 font-extrabold"},"\u5C0B\u627E\u55AE\u8ECA,",-1)),kt=Q(()=>i("p",{class:"text-2xl text-primary-500 font-extrabold pb-4"}," \u4F86\u5834\u60A0\u9592\u7684\u653E\u9B06\u4E4B\u65C5\uFF01 ",-1)),bt=Q(()=>i("img",{class:"fixed bottom-60 md:bottom-6",src:_t},null,-1));function St(t,o,e,a,s,r){const n=S("Search");return h(),f("div",mt,[i("div",wt,[ft,vt,kt,b(n,{onUpdateCity:a.updateCity,onUpdateKeyword:a.updateKeyword,onSearch:a.search,city:t.city,keyword:t.keyword},null,8,["onUpdateCity","onUpdateKeyword","onSearch","city","keyword"])]),bt])}var xt=C(ht,[["render",St],["__scopeId","data-v-c221866a"]]);const Lt=(t,o="success")=>{t&&console.log(t,o)},X=(t,o)=>{let e="",a="";switch(t){case 0:e="no-available",a="\u505C\u6B62\u71DF\u904B";break;case 1:e="available",a="\u6B63\u5E38\u71DF\u904B";break;case 2:e="no-rent",a="\u66AB\u505C\u71DF\u904B";break}return o==="color"?e:a},U=ve.create({});U.interceptors.request.use(t=>{let o=t.params;return Object.keys(o).map(e=>{o[e]||delete o[e]}),t},t=>t);U.interceptors.response.use(t=>t.data,t=>{const{status:o}=t.response;return Lt(`error--${o}`,"error"),Promise.reject(t)});const V=()=>{let t="b65665fcca144956a79d25bb3edc7b34",o="daVxLDO01nPgTTwhQKVBmY-pjeQ";const e=new Date().toGMTString(),a=new ke("SHA-1","TEXT");a.setHMACKey(o,"TEXT"),a.update("x-date: "+e);let s=a.getHMAC("B64");return{Authorization:`hmac username="${t}", algorithm="hmac-sha1", headers="x-date", signature="${s}"`,"X-Date":e,"Content-Type":"application/x-www-form-urlencoded"}},O=t=>{const{city:o=""}=t;return delete t.city,{cityPath:o,data:t}},$t=t=>{const{cityPath:o,data:e}=O(t);let a={headers:V(),params:T({},e)};return U.get(et+`/${o}`,a)},Pt=t=>{const{cityPath:o,data:e}=O(t);let a={headers:V(),params:T({},e)};return U.get(tt+`/${o}`,a)},At=t=>{const{cityPath:o,data:e}=O(t);let a={headers:V(),params:T({},e)};return U.get(ot+`/${o}`,a)},It=t=>{let o={headers:V(),params:T({},t)};return U.get(at,o)},Ct=t=>{let o={headers:V(),params:T({},t)};return U.get(nt,o)},Tt=t=>{const{cityPath:o,data:e}=O(t);let a={headers:V(),params:T({},e)};return U.get(rt+`/${o}`,a)},Mt=t=>{const{cityPath:o,data:e}=O(t);let a={headers:V(),params:T({},e)};return U.get(st+`/${o}`,a)};const Ut={emits:["getRoute"],setup(t,{emit:o}){let e=null,a=null,s=null,r=null,n=null;const l=()=>{let u="pk.eyJ1Ijoiam9lY2hhbmcxMDE0IiwiYSI6ImNrdno1ZnM3OTRtM2YzMG8wYnA2NGxpZzEifQ.EDTMLv4rcckA89UjJNWgXQ";e=m.map("map_route"),m.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:u}).addTo(e),n=new m.MarkerClusterGroup().addTo(e),N()},$=()=>{n.clearLayers(),e.eachLayer(u=>{u instanceof m.Marker&&e.removeLayer(u)})},p=u=>{let y=u.replace("MULTILINESTRING ((","").replace("))","").split(",");console.log("newStr");const c=y[0]&&y[0].split(" "),d=y[y.length-1]&&y[y.length-1].split(" ");n.addLayer(m.marker([c[1],c[0]],{icon:a})),n.addLayer(m.marker([d[1],d[0]],{icon:a})),e.addLayer(n),v(c[0],c[1]),w(c[0],c[1])},A=(u,k)=>{k.map(y=>y.Position).forEach(y=>{const{PositionLon:c,PositionLat:d}=y.Position;let _=u==="food"?s:r;n.addLayer(m.marker([d,c],{icon:_}))}),e.addLayer(n)},v=async(u,k)=>{const P={$spatialFilter:`nearby(${u},${k},${500})`};try{const y=await Mt(P);A(y,"spot")}catch(y){console.log("error",y)}},w=async()=>{try{const u=await Tt();A(u,"food")}catch(u){console.log("error",u)}},N=()=>{o("getRoute")},g=()=>{a=new m.Icon({iconUrl:"/images/mark/no_rent.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),s=new m.Icon({iconUrl:"/images/mark/food.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),r=new m.Icon({iconUrl:"/images/mark/spot.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]})},I=u=>{console.log("Geometry",u),$();const k=new be.exports.Wkt;k.read(u);const P=k.toJson(),y={color:"#C50047",weight:5};n=m.geoJSON(P,{style:y}).addTo(e),n.addData(P),e.fitBounds(n.getBounds()),e.addLayer(n),p(u)};return G(()=>{g(),l()}),ce(()=>{e=null,n=null}),{drawLine:I}}},Bt=t=>(W("data-v-3aad47fd"),t=t(),ee(),t),Rt=Bt(()=>i("div",{id:"map_route",class:"map w-screen relative z-10"},null,-1));function Nt(t,o,e,a,s,r){return h(),f(B,null,[Rt,Y(` <div>
        <h3 class="text-xl font-bold">
            {{ item.StationName.Zh_tw }}
        </h3>
        <h4>
            <font-awesome-icon icon="map-marker-alt" />
            {{ item.StationAddress.Zh_tw }}
        </h4>
        <p>{{ transTime(item.UpdateTime) }}</p>
        <p class="py-2">
            <span
                :class="
                    item.AvailableRentBikes > 0 ? 'available' : 'no-available'
                "
                >{{
                    item.AvailableRentBikes > 0 ? "\u5C1A\u6709\u55AE\u8ECA" : "\u5DF2\u7121\u55AE\u8ECA"
                }}</span
            >
            <span
                :class="item.AvailableReturnBikes > 0 ? 'available' : 'no-rent'"
                >{{
                    item.AvailableReturnBikes > 0 ? "\u5C1A\u53EF\u9084\u8ECA" : "\u5DF2\u7121\u8ECA\u4F4D"
                }}</span
            >
        </p>
        <div class="flex items-center justify-between">
            <div
                class="
                    w-2/5
                    rounded-md
                    border-primary-500
                    text-center
                    py-2
                    boder
                "
            >
                <p class="font-bold text-primary-500">\u53EF\u501F\u55AE\u8ECA</p>
                <p class="font-bold text-xl">
                    {{ item.AvailableReturnBikes || 2 }}
                </p>
            </div>
            <div
                class="
                    w-2/5
                    rounded-md
                    border-primary-500
                    text-center
                    py-2
                    boder
                "
            >
                <p class="font-bold text-primary-500">\u53EF\u505C\u7A7A\u4F4D</p>
                <p class="font-bold text-xl">
                    {{ item.AvailableReturnBikes || 2 }}
                </p>
            </div>
        </div>
    </div> `)],2112)}var Kt=C(Ut,[["render",Nt],["__scopeId","data-v-3aad47fd"]]);const Dt={components:{VPagination:Se},setup(){const t=F("page"),o=F("totalPage"),e=F("setPage");return{page:t,totalPage:o,updateHandler:s=>{e(s)}}}};function Vt(t,o,e,a,s,r){const n=S("v-pagination");return h(),ie(n,{"v-model":a.page,pages:a.totalPage,"range-size":1,"active-color":"#DCEDFF","onUpdate:modelValue":a.updateHandler},null,8,["v-model","pages","onUpdate:modelValue"])}var pe=C(Dt,[["render",Vt]]);const zt={components:{Pagination:pe,Search:ae},props:{singlePageList:{type:Array,default:()=>[]},keyword:{type:String,default:""},city:{type:String,default:""}},emits:["setView","updateKeyword","updateCity","search"],setup(t,{emit:o}){return{setView:n=>{o("setView",n)},updateCity:n=>{o("updateCity",n)},updateKeyword:n=>{o("updateKeyword",n)},search:()=>{o("search")}}}},Ot={class:"h-full w-96 fixed px-8 left-0 top-0 z-20 box-border pt-24 overflow-hidden bg-white"},Et={class:"rounded-xl shadow-lg overflow-hidden"},jt=i("div",{class:"h-8 bg-primary-500"},null,-1),Ht={class:"p-4"},Zt=i("h1",{class:"text-3xl font-bold mb-6"},"\u5C0B\u627E\u8ECA\u9053",-1),Yt={class:"h-3/4 overflow-y-scroll mt-8"},Gt={class:""},Ft=["onClick"],qt={class:"text-xl font-bold pb-2"},Jt={class:"mr-8"},Qt=i("span",{class:"sub-title"},"\u958B\u59CB",-1),Xt=i("span",{class:"sub-title"},"\u7D50\u675F",-1);function Wt(t,o,e,a,s,r){const n=S("Search"),l=S("font-awesome-icon"),$=S("pagination");return h(),f("div",Ot,[i("div",Et,[jt,i("div",Ht,[Zt,b(n,{onSearch:a.search,onUpdateCity:a.updateCity,onUpdateKeyword:a.updateKeyword,city:e.city,keyword:e.keyword},null,8,["onSearch","onUpdateCity","onUpdateKeyword","city","keyword"])])]),i("div",Yt,[i("ul",Gt,[(h(!0),f(B,null,Z(e.singlePageList,p=>(h(),f("li",{class:"bg-grey-100 rounded-xl mb-3 px-2 py-4 cursor-pointer",key:p.StationUID,onClick:A=>a.setView(p)},[i("h3",qt,L(p.RouteName),1),i("h4",null,[b(l,{class:"text-primary-500",icon:"map-marker-alt"}),M(" "+L(`${p.City} ${p.Town}`),1)]),i("p",null,[i("span",Jt,[b(l,{class:"text-primary-500 mr-2",icon:"exchange-alt"}),M(L(p.Direction||"\u55AE\u5411"),1)]),i("span",null,[b(l,{class:"text-primary-500 mr-2",icon:"route"}),M(L(p.CyclingLength)+"\u516C\u5C3A",1)])]),i("p",null,[Qt,M(L(p.RoadSectionStart),1)]),i("p",null,[Xt,M(L(p.RoadSectionEnd),1)]),Y(" <button >\u67E5\u770B\u4F4D\u7F6E</button> ")],8,Ft))),128))])]),b($)])}var eo=C(zt,[["render",Wt]]);const to={components:{MapRoute:Kt,RouteList:eo},setup(){const t=te(null),o=R({keyword:"",city:J[0].value,page:1,totalPage:1}),e=v=>{o.city=v},a=v=>{o.keyword=v},s=R([]),r=async()=>{const v={city:o.city};try{const w=await At(v);console.log("result",w),w.length>0&&(console.log("innnnn"),Object.assign(s,w),o.totalPage=Math.ceil(s.length/30),o.page=1,A())}catch(w){console.log("error",w)}},n=v=>{o.page=v,A()},l=()=>{r()},$=v=>{t.value.drawLine(v)};K("totalPage",q(o,"totalPage")),K("page",q(o,"page")),K("setPage",n);const p=R([]),A=()=>{const v=[...s],w=(o.page-1)*30,N=v.splice(w,30);Object.assign(p,N);const g=p[0];$(g.Geometry)};return G(()=>{}),H(T({},oe(o)),{updateCity:e,updateKeyword:a,singlePageList:p,getRoute:r,mapInstance:t,drawLine:$,search:l})}};function oo(t,o,e,a,s,r){const n=S("map-route"),l=S("route-list");return h(),f(B,null,[M(L(t.routeDataList)+" ",1),b(n,{ref:"mapInstance",singlePageList:a.singlePageList,onGetRoute:a.getRoute},null,8,["singlePageList","onGetRoute"]),b(l,{onSearch:a.search,onDrawLine:a.drawLine,onUpdateCity:a.updateCity,onUpdateKeyword:a.updateKeyword,singlePageList:a.singlePageList,keyword:t.keyword,city:t.city},null,8,["onSearch","onDrawLine","onUpdateCity","onUpdateKeyword","singlePageList","keyword","city"])],64)}var ao=C(to,[["render",oo]]);const no={props:{singlePageList:{type:Array,default:()=>[]}},emits:["mapReady"],setup(t,{emit:o}){let e=null,a=null,s=null,r=null,n=null;const l=()=>{let g="pk.eyJ1Ijoiam9lY2hhbmcxMDE0IiwiYSI6ImNrdno1ZnM3OTRtM2YzMG8wYnA2NGxpZzEifQ.EDTMLv4rcckA89UjJNWgXQ";e=m.map("map"),m.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:g}).addTo(e),a=new m.MarkerClusterGroup().addTo(e),o("mapReady")},$=()=>{a.clearLayers(),e.eachLayer(g=>{g instanceof m.Marker&&e.removeLayer(g)})},p=(g,I)=>{e.setView([g,I],18),m.marker([g,I],{icon:s}).addTo(e).bindPopup("\u4F60\u5728\u9019\uFF5E").openPopup()},A=g=>{let{PositionLat:I,PositionLon:u}=g.StationPosition,{AvailableRentBikes:k,AvailableReturnBikes:P,UpdateTime:y,StationName:c,StationAddress:d,ServiceStatus:_}=g;$(),e.setView([I,u],20),m.popup().setLatLng([I,u]).setContent(`
                <h3 class="text-xl font-bold">
                    ${c.Zh_tw}
                </h3>
                <h4>
                    <font-awesome-icon icon="map-marker-alt" />
                    ${d.Zh_tw}
                </h4>
                <p>${w(y)}</p>
                <p class="py-2">
                    <span class="${X(_,"color")}">
                        ${X(_,"type")}
                    </span>
                    <span
                        class="
                            ${k>0?"available":"no-available"}
                        "
                        >
                            ${k>0?"\u5C1A\u6709\u55AE\u8ECA":"\u5DF2\u7121\u55AE\u8ECA"}
                        </span>
                </p>
                <div class="flex items-center justify-between">
                    <div class="w-1/2 rounded-md border-primary-500 mr-4 text-center py-2 border">
                        <p class="font-bold text-primary-500 text-xl">\u53EF\u501F\u55AE\u8ECA</p>
                        <p class="font-bold text-xl">
                            ${k}
                        </p>
                    </div>
                    <div class="w-1/2 rounded-md border-primary-500 text-center py-2 border">
                        <p class="font-bold text-primary-500 text-xl">\u53EF\u505C\u7A7A\u4F4D</p>
                        <p class="font-bold text-xl">
                            ${P}
                        </p>
                    </div>
                </div> `).openOn(e)},v=()=>{r=new m.Icon({iconUrl:"./images/mark/no_rent.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),n=new m.Icon({iconUrl:"./images/mark/bike.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),s=new m.Icon({iconUrl:"./images/mark/currentLocation.png",shadowUrl:"",iconSize:[40,41],iconAnchor:[12,41],popupAnchor:[1,-34]})},w=g=>new Date(g).toString("Zh_tw"),N=()=>{console.log("drawMark",t.singlePageList),t.singlePageList.forEach(g=>{let{PositionLat:I,PositionLon:u}=g.StationPosition,{AvailableRentBikes:k}=g;const P=k>0?n:r;a.addLayer(m.marker([I,u],{icon:P}))}),e.addLayer(a)};return G(()=>{v(),l()}),ce(()=>{console.log("onBeforeUnmount--bikemap"),e=null,a=null}),{drawSelfMark:p,drawMark:N,setView:A,transType:X}}},so={id:"map",class:"map w-screen relative z-10"};function ro(t,o,e,a,s,r){return h(),f("div",so)}var io=C(no,[["render",ro]]);const co={components:{Pagination:pe,Search:ae},props:{singlePageList:{type:Array,default:()=>[]},keyword:{type:String,default:""},city:{type:String,default:""}},emits:["setView","updateKeyword","updateCity","search"],setup(t,{emit:o}){const e=n=>{o("setView",n)},a=n=>{o("updateKeyword",n)},s=n=>{o("updateCity",n)},r=()=>{o("search")};return xe("singlePageList",()=>{console.warn("change~~",singlePageList)}),{setView:e,updateCity:s,updateKeyword:a,search:r,transType:X}}},lo={class:"h-full w-96 fixed px-8 left-0 top-0 z-20 box-border pt-24 overflow-hidden bg-white"},po={class:"rounded-xl shadow-lg overflow-hidden"},uo=i("div",{class:"h-8 bg-primary-500"},null,-1),go={class:"p-4"},yo=i("h1",{class:"text-3xl font-bold mb-6"},"\u5C0B\u627E\u55AE\u8ECA",-1),_o={class:"h-3/4 overflow-y-scroll mt-8 mb-4"},ho={class:""},mo=["onClick"],wo={class:"text-xl font-bold"},fo={class:"py-2"};function vo(t,o,e,a,s,r){const n=S("Search"),l=S("font-awesome-icon"),$=S("pagination");return h(),f("div",lo,[i("div",po,[uo,i("div",go,[yo,b(n,{onSearch:a.search,onUpdateCity:a.updateCity,onUpdateKeyword:a.updateKeyword,city:e.city,keyword:e.keyword},null,8,["onSearch","onUpdateCity","onUpdateKeyword","city","keyword"])])]),i("div",_o,[M(L(e.singlePageList)+" ",1),i("ul",ho,[(h(!0),f(B,null,Z(e.singlePageList,p=>(h(),f("li",{class:"bg-grey-100 rounded-xl mb-3 px-2 py-4 cursor-pointer",key:p.StationUID,onClick:A=>a.setView(p)},[i("h3",wo,L(p.StationName.Zh_tw),1),i("h4",null,[b(l,{icon:"map-marker-alt"}),M(" "+L(p.StationAddress.Zh_tw),1)]),i("p",fo,[i("span",{class:le(a.transType(p.ServiceStatus,"color"))},L(a.transType(p.ServiceStatus,"type")),3),i("span",{class:le(p.AvailableRentBikes>0?"available":"no-available")},L(p.AvailableRentBikes>0?"\u5C1A\u6709\u55AE\u8ECA":"\u5DF2\u7121\u55AE\u8ECA"),3)]),Y(" <button >\u67E5\u770B\u4F4D\u7F6E</button> ")],8,mo))),128))])]),b($)])}var ko=C(co,[["render",vo]]);const bo={components:{MapBike:io,BikeList:ko},setup(){const t=te(null),o=Le(),e=R({keyword:"",city:J[0].value,page:1,totalPage:1}),a=c=>{e.city=c},s=c=>{e.keyword=c},r=()=>{const c=o.query.city;c&&(e.city=c);const d=o.query.keyword;d&&(e.keyword=d),c||d?A():(console.log("getNowPos!!!"),I())},n=F("setShowLoading");console.log("setShowLoading--inject",n);const l=c=>{n(c)},$=()=>{A()},p=R([]),A=async()=>{console.log("getBikeStation");const c={city:e.city,$filter:e.keyword?`contains(StationAddress.Zh_tw,'${e.keyword}') or contains(StationName.Zh_tw,'${e.keyword}')`:""};try{const d=await $t(c);console.log("station",d),Object.assign(p,d),N()}catch(d){console.log("error",d)}},v=async({longitude:c,latitude:d})=>{console.log("getNearByInfo",c,d);const _={city:e.city,$filter:e.keyword?`contains(StationAddress.Zh_tw,'${e.keyword}') or contains(StationName.Zh_tw,'${e.keyword}')`:"",$spatialFilter:`nearby(${d},${c},${500})`};try{const x=await It(_);console.log("station",x),Object.assign(p,x),g(c,d)}catch(x){console.log("error",x)}},w=R([]),N=async()=>{l(!0);const c={city:e.city,$filter:e.keyword?`contains(StationAddress.Zh_tw,'${e.keyword}') or contains(StationName.Zh_tw,'${e.keyword}')`:""};try{const d=await Pt(c);d.forEach(_=>{p.forEach(x=>{x.StationUID===_.StationUID&&(_.StationName=x.StationName,_.StationPosition=x.StationPosition,_.StationAddress=x.StationAddress)})}),Object.assign(w,d),console.log("availableList",w),e.totalPage=Math.ceil(w.length/30),e.page=1,P()}catch(d){console.log("error",d)}l(!1)},g=async(c,d)=>{l(!0);const _={$spatialFilter:`nearby(${d},${c},${500})`};try{const x=await Ct(_);x.forEach(E=>{p.forEach(j=>{j.StationUID===E.StationUID&&(E.StationName=j.StationName,E.StationPosition=j.StationPosition,E.StationAddress=j.StationAddress)})}),Object.assign(w,x),console.log("availableList",w),e.totalPage=Math.ceil(w.length/30),e.page=1,P()}catch(x){console.log("error",x)}l(!1)},I=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(c=>{const d=c.coords.longitude,_=c.coords.latitude;console.log("longitude",d),console.log("latitude",_),t.value.drawSelfMark(_,d),v({longitude:d,latitude:_})},c=>{const{code:d,message:_}=c;console.log("error",`code=${d}, msg=${_}`),A()})},u=c=>{e.page=c,P()};K("totalPage",q(e,"totalPage")),K("page",q(e,"page")),K("setPage",u);const k=R([]),P=()=>{const c=[...w],d=(e.page-1)*30,_=c.splice(d,30);Object.assign(k,_),console.log("singlePageList",k),t.value.drawMark();const x=k[0];y(x)},y=c=>{t.value.setView(c)};return G(()=>{}),H(T({},oe(e)),{getNearByInfo:v,availableList:w,mapReady:r,mapInstance:t,updateCity:a,singlePageList:k,updateKeyword:s,setView:y,search:$})}};function So(t,o,e,a,s,r){const n=S("map-bike"),l=S("bike-list");return h(),f("div",null,[b(n,{ref:"mapInstance",singlePageList:a.singlePageList,onMapReady:a.mapReady},null,8,["singlePageList","onMapReady"]),b(l,{onSearch:a.search,onSetView:a.setView,onUpdateCity:a.updateCity,onUpdateKeyword:a.updateKeyword,singlePageList:a.singlePageList,city:t.city,keyword:t.keyword},null,8,["onSearch","onSetView","onUpdateCity","onUpdateKeyword","singlePageList","city","keyword"])])}var xo=C(bo,[["render",So]]);const Lo=[{path:"/",name:"Index",component:xt},{path:"/route",name:"Route",component:ao},{path:"/bike",name:"Bike",component:xo}],$o=$e({history:Pe(),routes:Lo});function Po(t){const e={tId:adminUse.Cookie("cAa")};t.commit("updLoading",!0),adminUse.getAjax(t.state.config.groupPath.platformAdmin+"/backLogOut",e).then(a=>{t.commit("updLoading",!1),a.resultCode=="000"?(adminUse.Cookie("remove","cAa"),t.commit("updMenuList",""),t.commit("updUserName",""),t.commit("updIsLogin",!1),adminUse.showToast(a.msg),router.push("/login")):adminUse.showToast(a.msg+"("+a.resultCode+")","red")})}var Ao=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",logout:Po});const Io=new Ae({storage:window.localStorage,reducer:t=>({myPlatformId:t.myPlatformId})}),Co=()=>({config:{}});var To=Ie({state:Co,mutations:{updBeep(t,o){t.beep=o}},actions:Ao,plugins:[Io.plugin],modules:{}});z.add(Ce);z.add(Te);z.add(Me);z.add(Ue);z.add(Be);const ue=Re(We);ue.component("font-awesome-icon",Ne);ue.use(To).use($o).use(Ke).mount("#app");
