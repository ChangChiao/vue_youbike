var q=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var R=(e,t,o)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,I=(e,t)=>{for(var o in t||(t={}))oe.call(t,o)&&R(e,o,t[o]);if(z)for(var o of z(t))ae.call(t,o)&&R(e,o,t[o]);return e},O=(e,t)=>ee(e,te(t));import{r as x,o as d,c as m,a as k,w as E,b as f,F as S,d as M,p as j,e as D,f as ne,t as T,g as C,h as re,i as se,j as ce,k as H,l as Y,L as u,m as V,n as ie,q as G,v as Z,s as le,u as ue,x as pe,y as de,V as me,z as he,A as ge,B as _e}from"./vendor.4ba96625.js";const fe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}};fe();var ye="./images/logo.png";var y=(e,t)=>{for(const[o,a]of t)e[o]=a;return e};const ve={setup(){return{menuList:[{title:"\u4ECA\u65E5\u5929\u6C23",path:"/weather"},{title:"\u81EA\u884C\u8ECA\u9053",path:"/bikemap"},{title:"\u5468\u570D\u666F\u9EDE",path:"/spot"},{title:"\u6B77\u53F2\u7D00\u9304",path:"/history"}]}}},K=e=>(j("data-v-61dd7a3d"),e=e(),D(),e),be={class:"flex justify-center box-border border-solid border-t-8 border-sub items-center font-medium"},we=K(()=>f("img",{class:"pr-10",src:ye,alt:""},null,-1)),$e={class:"input-box flex h-10 w-56 items-center rounded-3xl text-gray-500"},ke=K(()=>f("input",{class:"w-30 pl-4 bg-transparent text-gray-900",placeholder:"\u641C\u5C0B\u81EA\u884C\u8ECA\u79DF\u501F\u7AD9",type:"text"},null,-1)),Se={class:"menu flex"};function Ae(e,t,o,a,n,s){const r=x("router-link"),b=x("BootstrapIcon");return d(),m("header",be,[k(r,{to:"/"},{default:E(()=>[we]),_:1}),f("div",$e,[k(b,{icon:"search",size:"2x","flip-v":""}),ke]),f("ul",Se,[(d(!0),m(S,null,M(a.menuList,v=>(d(),m("li",{class:"mx-3 text-lg",key:v.path},[k(r,{to:v.path,class:"duration-200"},{default:E(()=>[ne(T(v.title),1)]),_:2},1032,["to"])]))),128))])])}var P=y(ve,[["render",Ae],["__scopeId","data-v-61dd7a3d"]]);const Ie={components:{Header:P},setup(){}};function xe(e){return(t,o)=>{const a=x("router-view");return d(),m(S,null,[k(P),k(a)],64)}}const Le=Object.assign(Ie,{setup:xe}),Me={components:{Header:P},setup(){return{address:C({list:[]})}}},Te={class:"text-grey-300 font-bold bg-green-500"};function Ce(e,t,o,a,n,s){return d(),m("div",null,[re(" <Header /> "),f("ul",Te,[(d(!0),m(S,null,M(a.address.list,r=>(d(),m("li",{key:r.StationUID},T(r.StationAddress),1))),128))])])}var Ne=y(Me,[["render",Ce]]);const Pe={setup(){}};function Be(e,t,o,a,n,s){return" weather "}var Ue=y(Pe,[["render",Be]]);const L=se.create();L.interceptors.request.use(e=>e,e=>e);L.interceptors.response.use(e=>e.data,e=>Promise.reject(e));const B="https://ptx.transportdata.tw/MOTC/v2",ze=B+"/Cycling/Shape",Re=B+"/Bike/Station/NearBy",Oe=B+"/Bike/Availability/NearBy",F=[{label:"\u81FA\u5317\u5E02",value:"Taipei"},{label:"\u65B0\u5317\u5E02",value:"NewTaipei"},{label:"\u6843\u5712\u5E02",value:"Taoyuan"},{label:"\u81FA\u4E2D\u5E02",value:"Taichung"},{label:"\u81FA\u5357\u5E02",value:"Tainan"},{label:"\u9AD8\u96C4\u5E02",value:"Kaohsiung"},{label:"\u57FA\u9686\u5E02",value:"Keelung"},{label:"\u65B0\u7AF9\u5E02",value:"Hsinchu"},{label:"\u65B0\u7AF9\u7E23",value:"HsinchuCounty"},{label:"\u82D7\u6817\u7E23",value:"MiaoliCounty"},{label:"\u5F70\u5316\u7E23",value:"ChanghuaCounty"},{label:"\u5357\u6295\u7E23",value:"NantouCounty"},{label:"\u96F2\u6797\u7E23",value:"YunlinCounty"},{label:"\u5609\u7FA9\u7E23",value:"ChiayiCounty"},{label:"\u5609\u7FA9\u5E02",value:"Chiayi"},{label:"\u5C4F\u6771\u7E23",value:"PingtungCounty"},{label:"\u5B9C\u862D\u7E23",value:"YilanCounty"},{label:"\u82B1\u84EE\u7E23",value:"HualienCounty"},{label:"\u81FA\u6771\u7E23",value:"TaitungCounty"},{label:"\u91D1\u9580\u7E23",value:"KinmenCounty"},{label:"\u6F8E\u6E56\u7E23",value:"PenghuCounty"},{label:"\u9023\u6C5F\u7E23",value:"LienchiangCounty"}],U=()=>{let e="b65665fcca144956a79d25bb3edc7b34",t="daVxLDO01nPgTTwhQKVBmY-pjeQ";console.log("AppID",e),console.log("AppKey",t);const o=new Date().toGMTString(),a=new ce("SHA-1","TEXT");a.setHMACKey(t,"TEXT"),a.update("x-date: "+o);let n=a.getHMAC("B64");return{Authorization:`hmac username="${e}", algorithm="hmac-sha1", headers="x-date", signature="${n}"`,"X-Date":o,"Content-Type":"application/x-www-form-urlencoded"}},Ee=e=>{const{city:t=""}=e;return delete e.city,{cityPath:t,data:e}},je=e=>{const{cityPath:t,data:o}=Ee(e);let a={headers:U(),params:I({},o)};return L.get(ze+`/${t}`,a)},De=e=>{let t={headers:U(),params:I({},e)};return L.get(Re,t)},He=e=>{let t={headers:U(),params:I({},e)};return L.get(Oe,t)},Ye={setup(){let e=null,t=null,o=null,a=null,n=null;const s=()=>{let l="pk.eyJ1Ijoiam9lY2hhbmcxMDE0IiwiYSI6ImNrdno1ZnM3OTRtM2YzMG8wYnA2NGxpZzEifQ.EDTMLv4rcckA89UjJNWgXQ";e=u.map("map"),u.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:l}).addTo(e),t=new u.MarkerClusterGroup().addTo(e),r()},r=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(l=>{const p=l.coords.longitude,h=l.coords.latitude;console.log("longitude",p),console.log("latitude",h),e.setView([h,p],18),u.marker([h,p],{icon:o}).addTo(e).bindPopup("\u4F60\u5728\u9019\uFF5E").openPopup(),N(p,h)},l=>{const{code:p,message:h}=l;console.log("error",`code=${p}, msg=${h}`)})},b=C([]),v=()=>{a=new u.Icon({iconUrl:"/images/mark/serviceStatus0, 2.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),n=new u.Icon({iconUrl:"/images/mark/available_0(goal).png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),o=new u.Icon({iconUrl:"images/mark/currentLocation.png",shadowUrl:"",iconSize:[40,41],iconAnchor:[12,41],popupAnchor:[1,-34]})},N=async(l,p)=>{const h={$spatialFilter:`nearby(${p},${l},${500})`};try{const g=await De(h);console.log("station",g),Object.assign(b,g),c(l,p)}catch(g){console.log("error",g)}},A=C([]),c=async(l,p)=>{const h={$spatialFilter:`nearby(${p},${l},${500})`};try{const g=await He(h);g.forEach(w=>{b.forEach($=>{$.StationUID===w.StationUID&&(w.StationName=$.StationName,w.StationPosition=$.StationPosition,w.StationAddress=$.StationAddress)})}),Object.assign(A,g),console.log("availableList",A),_()}catch(g){console.log("error",g)}},i=l=>new Date(l).toString("Zh_tw"),_=()=>{A.forEach(l=>{let{PositionLat:p,PositionLon:h}=l.StationPosition,{AvailableRentBikes:g,AvailableReturnBikes:w,UpdateTime:$,StationName:Q,StationAddress:W}=l;const X=g>0?n:a;t.addLayer(u.marker([p,h],{icon:X}).bindPopup(`
                <h2 class="title">${Q.Zh_tw}</h2>
                <h4>\u5730\u5740:${W.Zh_tw}</h4>
                <h4>\u53EF\u501F\u8173\u8E0F\u8ECA\u6578:${g}</h4>
                <h4>\u53EF\u9084\u8173\u8E0F\u8ECA\u6578:${w}</h4>
                <h4>\u66F4\u65B0\u6642\u9593:${i($)}</h4>
                <a target="_blank" href='https://www.google.com/maps/search/?api=1&query=${p},${h}'>\u5728google map\u4E0A\u67E5\u770B</a>`))}),e.addLayer(t)};return H(()=>{v(),s()}),Y(()=>{e=null}),{}}},Ve={id:"map",class:"w-screen h-screen"};function Ge(e,t,o,a,n,s){return d(),m("div",Ve)}var Ze=y(Ye,[["render",Ge]]);const Ke={components:{Map:Ze},setup(){}};function Fe(e,t,o,a,n,s){const r=x("Map");return d(),m("div",null,[k(r)])}var Je=y(Ke,[["render",Fe]]);const Qe={setup(){}};function We(e,t,o,a,n,s){return null}var Xe=y(Qe,[["render",We]]);const qe={setup(){let e=null,t=null,o=null;const a=C({city:F[0].value,bikeRoute:"",routeList:[]}),n=()=>{let c="pk.eyJ1Ijoiam9lY2hhbmcxMDE0IiwiYSI6ImNrdno1ZnM3OTRtM2YzMG8wYnA2NGxpZzEifQ.EDTMLv4rcckA89UjJNWgXQ";e=u.map("map_route"),u.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:c}).addTo(e),o=new u.MarkerClusterGroup().addTo(e),N()},s=()=>{o.clearLayers(),e.eachLayer(c=>{c instanceof u.Marker&&e.removeLayer(c)})},r=async()=>{const c={city:a.city};try{const i=await je(c);i.length>1&&(a.routeList=i,a.bikeRoute=i[0].RouteName)}catch(i){console.log("error",i)}},b=()=>{const{Geometry:c}=a.routeList.find(i=>i.RouteName===a.bikeRoute);A(c)};V(()=>a.city,()=>{r()}),V(()=>a.bikeRoute,()=>{b()});const v=()=>{new u.Icon({iconUrl:"/images/mark/RecordCircle.png",shadowUrl:"",iconSize:[40,40],iconAnchor:[12,41],popupAnchor:[1,-34]}),t=new u.Icon({iconUrl:"images/mark/currentLocation.png",shadowUrl:"",iconSize:[40,41],iconAnchor:[12,41],popupAnchor:[1,-34]})},N=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(c=>{const i=c.coords.longitude,_=c.coords.latitude;console.log("longitude",i),console.log("latitude",_),e.setView([_,i],18),u.marker([_,i],{icon:t}).addTo(e).bindPopup("A pretty CSS3 popup.<br> Easily customizable.").openPopup(),r()},c=>{const{code:i,message:_}=c;console.log("error",`code=${i}, msg=${_}`)})},A=c=>{console.log("Geometry",c),s();const i=new le.exports.Wkt;i.read(c);const _=i.toJson(),l={color:"olive",weight:5};o=u.geoJSON(_,{style:l}).addTo(e),o.addData(_),e.fitBounds(o.getBounds()),e.addLayer(o)};return H(()=>{v(),n()}),Y(()=>{e=null}),O(I({},ie(a)),{CITY_LIST:F})}},et=e=>(j("data-v-3aad47fd"),e=e(),D(),e),tt=et(()=>f("div",{id:"map_route",class:"w-screen h-screen"},null,-1)),ot={class:"fixed top-20 right-10 w-20 h-20 z-20"},at=["value"],nt=["value"];function rt(e,t,o,a,n,s){return d(),m(S,null,[tt,f("div",ot,[G(f("select",{name:"",id:"","onUpdate:modelValue":t[0]||(t[0]=r=>e.city=r)},[(d(!0),m(S,null,M(a.CITY_LIST,r=>(d(),m("option",{key:r.value,value:r.value},T(r.label),9,at))),128))],512),[[Z,e.city]]),G(f("select",{name:"",id:"","onUpdate:modelValue":t[1]||(t[1]=r=>e.bikeRoute=r)},[(d(!0),m(S,null,M(e.routeList,r=>(d(),m("option",{key:r.RouteName,value:r.RouteName},T(r.RouteName),9,nt))),128))],512),[[Z,e.bikeRoute]])])],64)}var st=y(qe,[["render",rt],["__scopeId","data-v-3aad47fd"]]);const ct={components:{MapRoute:st},setup(){}};function it(e,t,o,a,n,s){const r=x("map-route");return d(),ue(r)}var lt=y(ct,[["render",it]]);const ut=[{path:"/",name:"Index",component:Ne},{path:"/weather",name:"Weather",component:Ue},{path:"/bikemap",name:"BikeMap",component:Je},{path:"/history",name:"History",component:Xe},{path:"/Spot",name:"Spot",component:lt}],pt=pe({history:de(),routes:ut});function dt(e){const o={tId:adminUse.Cookie("cAa")};e.commit("updLoading",!0),adminUse.getAjax(e.state.config.groupPath.platformAdmin+"/backLogOut",o).then(a=>{e.commit("updLoading",!1),a.resultCode=="000"?(adminUse.Cookie("remove","cAa"),e.commit("updMenuList",""),e.commit("updUserName",""),e.commit("updIsLogin",!1),adminUse.showToast(a.msg),router.push("/login")):adminUse.showToast(a.msg+"("+a.resultCode+")","red")})}var mt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",logout:dt});const ht=new me({storage:window.localStorage,reducer:e=>({myPlatformId:e.myPlatformId})}),gt=()=>({config:{}});var _t=he({state:gt,mutations:{updBeep(e,t){e.beep=t}},actions:mt,plugins:[ht.plugin],modules:{}});const J=ge(Le);J.component("BootstrapIcon",_e);J.use(_t).use(pt).mount("#app");
